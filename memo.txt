

-------------------------------------------------------------------------------
  実装メモ - ToDo
-------------------------------------------------------------------------------

2015-08-23

-------------------------------------------------------------------------------
  実装メモ - 過去
-------------------------------------------------------------------------------

2015-08-23

  * サービスとして登録できるようにする為には、以下の事が必要である。
    1 子プロセスを作って終了するのではなく自プロセスで処理する
    2 SIGTERM などのシグナルで正しく終了できるようにする

    1 に関してはオプションで指定できるようにする。

    2 に関して:

    現状では自分自身が終了するだけで子の ssh プロセスなどは終了されない。
    ssh プロセスがその儘だと port が占有されたままになってしまうので、
    再起動した時に正しく port を割り当てることができない。

    これに対応する為には、子の ssh プロセスの ID が分かる様になっていないといけない。
    適当に ssh & sshpid=$!; wait "$sshpid" とした。
    一方で trap sshward/TRAPTERM TERM INT QUIT としてシグナルを捕まえる。
    trap 関数の中で子のプロセスを削除すればよい。
    シグナルを捕まえると既定のシグナルの動作がキャンセルされるので、自身も終了する。
    exit 143 で終了する事にした。

  * 更に service として登録する為の init script 雛型 (service.sh)、
    install 用のスクリプトを追加した。
